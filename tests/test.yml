---

- hosts: all
  become: True

  pre_tasks:
    - name: Update local apt cache
      apt:
        update_cache: True
      when: ansible_distribution == 'Ubuntu'

  roles:
    - role: openstack-repo
      when: ansible_os_family == 'RedHat'

    - role: rabbitmq
      rabbitmq_plugins:
        - 'rabbitmq_management'
      rabbitmq_tcp_address: '0.0.0.0'
      rabbitmq_vhosts:
        - name: 'test_vhost'
      rabbitmq_users:
        - vhost: 'test_vhost'
          user: 'test_user'
          password: 'password1'
